<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liberty Signal Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-light: #1a1a1a;
            --card-bg: #1e1e1e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent-gold: #d4af37;
            --accent-gold-light: #f0e6c2;
            --accent-gold-dark: #b89535;
            --accent-green: #2ecc71;
            --accent-red: #e74c3c;
            --border-color: #2d2d2d;
            --positive: #00e676;
            --negative: #ff5252;
            --gold-gradient: linear-gradient(135deg, #d4af37, #f0e6c2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            background-image: radial-gradient(circle at 10% 20%, rgba(212, 175, 55, 0.05) 0%, rgba(212, 175, 55, 0.05) 90%);
        }

        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            max-width: 100%;
            margin: 0 auto;
        }

        /* Sidebar */
        .sidebar {
            background-color: var(--bg-light);
            padding: 20px;
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            position: relative;
            z-index: 10;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            gap: 12px;
        }

        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
        }

        .logo h1 {
           font-size: 20px;
            font-weight: 600;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.2);
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent-gold);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 13px;
            color: var(--accent-gold-light);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        select {
           width: 100%;
            padding: 12px 15px;
            background-color: var(--card-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23d4af37' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            transition: all 0.3s ease;
        }

        .btn {
           width: 100%;
            padding: 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
           background-color: var(--accent-gold);
            color: #121212;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            background-color: var(--accent-gold-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-ai {
           background: var(--gold-gradient);
            color: #121212;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-ai:active:not(:disabled) {
            transform: translateY(0);
        }

        /* Simple Calculator */
        .simple-calculator {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

         .simple-calculator:hover {
            border-color: var(--accent-gold);
        }

        .calculator-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--accent-gold);
        }

        .calculator-title i {
            color: var(--accent-gold);
        }

        .calculator-input {
            margin-bottom: 15px;
        }

        .calculator-input label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
            color: var(--accent-gold-light);
        }

        .calculator-input input {
            width: 100%;
            padding: 10px;
            background-color: rgba(212, 175, 55, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .calculator-result {
            background-color: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculator-result:hover {
            background-color: rgba(212, 175, 55, 0.15);
        }

        .calculator-result-label {
            font-size: 12px;
            color: var(--accent-gold-light);
            margin-bottom: 5px;
        }

        .calculator-result-value {
            font-size: 18px;
            font-weight: 600;
              color: var(--accent-gold);
        }

        /* Main Content */
        .main-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .signal-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .signal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

  .signal-card:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }

        .signal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            letter-spacing: 0.5px;
        }

        .signal-time {
            font-size: 13px;
            color: var(--accent-gold-light);
        }

        .signal-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .signal-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .signal-pair {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--accent-gold);
            letter-spacing: 1px;
        }

        .signal-direction {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 15px;
            position: relative;
            padding: 10px 30px;
            border-radius: 30px;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .signal-buy {
            color: var(--accent-green);
            background-color: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .signal-sell {
            color: var(--accent-red);
            background-color: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .signal-accuracy {
         font-size: 16px;
            color: var(--accent-gold-light);
            margin-top: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            background-color: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .signal-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .signal-detail {
           background-color: rgba(212, 175, 55, 0.05);
            padding: 12px;
            border-radius: 8px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .signal-detail:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(212, 175, 55, 0.3);
        }

        .detail-label {
            font-size: 12px;
            color: var(--accent-gold-light);
            margin-bottom: 5px;
        }

        .detail-value {
            font-size: 16px;
            font-weight: 600;
        }

        .signal-placeholder {
            padding: 40px 0;
            text-align: center;
            color: var(--accent-gold-light);
            font-size: 15px;
            grid-column: 1 / -1;
        }

        /* Chart */
        .chart-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

         .chart-container:hover {
            border-color: var(--accent-gold);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-gold);
            letter-spacing: 0.5px;
        }

        .chart-wrapper {
            flex-grow: 1;
            position: relative;
            min-height: 300px;
        }

        #chart {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        .chart-placeholder {
      display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--accent-gold-light);
            font-size: 14px;
        }

        .chart-placeholder i {
            font-size: 40px;
            margin-bottom: 15px;
            opacity: 0.3;
            color: var(--accent-gold);
        }

        /* Indicators */
        .indicators {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .indicators-placeholder {
            grid-column: 1 / -1;
            text-align: center;
            color: var(--accent-gold-light);
            font-size: 14px;
            padding: 20px 0;
        }

        .indicator {
            background-color: rgba(212, 175, 55, 0.05);
            border-radius: 8px;
            padding: 15px;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid rgba(212, 175, 55, 0.1);
        }

        .indicator:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-color: rgba(212, 175, 55, 0.3);
        }

        .indicator-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .indicator-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--accent-gold-light);
        }

        .indicator-value {
            font-size: 14px;
            font-weight: 600;
        }

        .positive {
            color: var(--accent-green);
        }

        .negative {
            color: var(--accent-red);
        }

        .indicator-bar {
            height: 4px;
            background-color: rgba(212, 175, 55, 0.1);
            border-radius: 2px;
            margin-top: 8px;
            overflow: hidden;
        }

        .indicator-progress {
            height: 100%;
            border-radius: 2px;
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
            grid-column: 1 / -1;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(212, 175, 55, 0.1);
            border-radius: 50%;
            border-top-color: var(--accent-gold);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            color: var(--accent-gold-light);
            font-size: 14px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 100;
            background: var(--gold-gradient);
            color: #121212;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        /* Cooldown message */
        .cooldown-message {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .cooldown-message.active {
            opacity: 1;
        }

        /* Telegram Mini App adjustments */
        @media (max-width: 768px) {
            body {
                padding-top: 0 !important;
            }

            .container {
                min-height: calc(100vh - 0px) !important;
            }

            .menu-toggle {
                top: 10px !important;
                left: 10px !important;
            }
        }

        /* Hide menu toggle on desktop */
        @media (min-width: 993px) {
            .menu-toggle {
                display: none !important;
            }
        }

        /* Telegram specific styles */
        .tg-mobile .menu-toggle {
            display: flex !important;
        }

        .tg-mobile .sidebar {
            left: -100%;
            transition: left 0.3s;
        }

        .tg-mobile .sidebar.active {
            left: 0;
        }

        /* Hide scrollbars in Telegram */
        .tg-scrollable {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .tg-scrollable::-webkit-scrollbar {
            display: none;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .indicators {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: -100%;
                bottom: 0;
                width: 100%;
                height: 100%;
                transition: left 0.3s;
                z-index: 50;
            }

            .sidebar.active {
                left: 0;
            }

            .main-content {
                margin-left: 0;
                padding-top: 70px;
            }

            .signal-content {
                grid-template-columns: 1fr;
            }

            .indicators {
                grid-template-columns: repeat(2, 1fr);
            }

            .menu-toggle {
                display: flex;
            }
        }

        @media (max-width: 768px) {
            .chart-controls {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .indicators {
                grid-template-columns: 1fr;
            }

            .signal-details {
                grid-template-columns: 1fr;
            }

            .main-content {
                padding: 15px;
            }

            .signal-card, .chart-container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
    </div>

    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <img src="https://i.imgur.com/2pP20Vb.jpeg" alt="Liberty Signal Pro">
                <h1>Liberty Signal</h1>
            </div>

            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="currency-search" placeholder="Search currency pair...">
            </div>

            <div class="input-group">
                <label for="currency-pair">Instrument</label>
                <select id="currency-pair">
                    <option>EURUSD</option>
                    <option>EURGBP</option>
                    <option>EURJPY</option>
                    <option>EURCAD</option>
                    <option>EURAUD</option>
                    <option>EURCHF</option>
                    <option>AUDUSD</option>
                    <option>AUDJPY</option>
                    <option>AUDCAD</option>
                    <option>AUDCHF</option>
                    <option>CADJPY</option>
                    <option>CADCHF</option>
                    <option>CHFJPY</option>
                    <option>GBPUSD</option>
                    <option>GBPJPY</option>
                    <option>GBPAUD</option>
                    <option>GBPCAD</option>
                    <option>GBPCHF</option>
                    <option>USDCAD</option>
                    <option>USDCHF</option>
                    <option>USDJPY</option>
                </select>
            </div>

            <div class="input-group">
                <label for="timeframe">Timeframe</label>
                <select id="timeframe">
                    <option>5 seconds</option>
                    <option>1 minute</option>
                    <option>2 minutes</option>
                    <option>3 minutes</option>
                    <option>4 minutes</option>
                    <option>5 minutes</option>
                    <option>15 minutes</option>
                    <option>30 minutes</option>
                </select>
            </div>

            <button id="generate-btn" class="btn btn-primary">
                <i class="fas fa-bolt"></i> Get Signal
                <div class="cooldown-message">Wait, not so much</div>
            </button>

            <button id="ai-generate-btn" class="btn btn-ai">
                <i class="fas fa-robot"></i> AI Generate
                <div class="cooldown-message">Wait, not so much</div>
            </button>

            <!-- Simple Calculator -->
            <div class="simple-calculator">
                <div class="calculator-title">
                    <i class="fas fa-calculator"></i>
                    <span>Position Calculator</span>
                </div>

                <div class="calculator-input">
                    <label for="input-amount">Your Amount ($)</label>
                    <input type="number" id="input-amount" placeholder="Enter amount">
                </div>

                <div class="calculator-result" id="calculator-result">
                    <div class="calculator-result-label">Amount to Use:</div>
                    <div class="calculator-result-value" id="result">$0.00</div>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="signal-card">
                <div class="signal-header">
                    <h2 class="signal-title">Trading Signal</h2>
                    <span class="signal-time" id="signal-time"></span>
                </div>

                <div id="signal-result" class="signal-content">
                    <div class="signal-placeholder">
                        <i class="fas fa-chart-line" style="font-size: 40px; margin-bottom: 15px; opacity: 0.3;"></i>
                        <p>Click "Get Signal" to analyze</p>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Technical Analysis</h2>
                </div>

                <div class="chart-wrapper">
                    <div id="chart">
                        <div class="chart-placeholder">
                            <i class="fas fa-chart-line"></i>
                            <p>Generate signal to view analysis</p>
                        </div>
                    </div>
                </div>

                <div class="indicators" id="indicators">
                    <div class="indicators-placeholder">
                        <i class="fas fa-chart-bar" style="font-size: 30px; margin-bottom: 10px; opacity: 0.3;"></i>
                        <p>Technical indicators will appear here after signal generation</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // Telegram Mini App initialization
            let tg = window.Telegram.WebApp;

            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                document.body.classList.add('tg-mobile');
                document.body.style.paddingTop = '0';
                document.querySelector('.container').style.minHeight = 'calc(100vh - 0px)';

                // Handle back button
                tg.BackButton.show();
                tg.BackButton.onClick(() => {
                    const sidebar = document.getElementById('sidebar');
                    if (sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                    } else {
                        tg.close();
                    }
                });

                // Expand the app to full view
                tg.expand();
                tg.enableClosingConfirmation();

                // Handle viewport changes
                tg.onEvent('viewportChanged', adjustViewport);
            }

            // Adjust viewport for mobile
            function adjustViewport() {
                const viewportMeta = document.querySelector('meta[name="viewport"]');
                if (window.innerWidth <= 768 || (window.Telegram && window.Telegram.WebApp.platform !== 'unknown')) {
                    viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
                } else {
                    viewportMeta.setAttribute('content', 'width=device-width, initial-scale=1.0');
                }
            }

            adjustViewport();
            window.addEventListener('resize', adjustViewport);

            // DOM elements
            const generateBtn = document.getElementById("generate-btn");
            const aiGenerateBtn = document.getElementById("ai-generate-btn");
            const currencyPairSelect = document.getElementById("currency-pair");
            const timeframeSelect = document.getElementById("timeframe");
            const signalResult = document.getElementById("signal-result");
            const signalTime = document.getElementById("signal-time");
            const chartContainer = document.getElementById("chart");
            const indicatorsContainer = document.getElementById("indicators");
            const currencySearch = document.getElementById("currency-search");
            const menuToggle = document.getElementById("menu-toggle");
            const sidebar = document.getElementById("sidebar");
            const calculatorResult = document.getElementById("calculator-result");

            // Get cooldown messages
            const generateCooldownMessage = generateBtn.querySelector('.cooldown-message');
            const aiGenerateCooldownMessage = aiGenerateBtn.querySelector('.cooldown-message');

            // Calculator elements
            const inputAmount = document.getElementById("input-amount");
            const resultElement = document.getElementById("result");

            // Button cooldown variables
            let isCooldown = false;
            const cooldownDuration = 10000; // 10 seconds

            // Mobile menu
            menuToggle.addEventListener("click", () => {
                sidebar.classList.toggle("active");
            });

            // Currency pair search
            currencySearch.addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    const searchTerm = currencySearch.value.trim().toUpperCase();
                    const options = Array.from(currencyPairSelect.options);

                    const foundOption = options.find(option =>
                        option.text.toUpperCase() === searchTerm
                    );

                    if (foundOption) {
                        currencyPairSelect.value = foundOption.text;
                        generateRandomSignal(false);
                    } else {
                        alert("Currency pair not found. Please select from the list.");
                    }
                }
            });

            // Simple calculator
            inputAmount.addEventListener("input", () => {
                const amount = parseFloat(inputAmount.value) || 0;
                const calculatedAmount = (amount * 2.2).toFixed(2);
                resultElement.textContent = `$${calculatedAmount}`;
            });

            // Copy amount to clipboard when clicking on calculator result
            calculatorResult.addEventListener("click", () => {
                const amountText = resultElement.textContent.replace('$', '');
                if (amountText !== '0.00') {
                    navigator.clipboard.writeText(amountText)
                        .then(() => {
                            // Show temporary feedback without replacing the entire HTML
                            const originalLabel = calculatorResult.querySelector('.calculator-result-label').textContent;
                            calculatorResult.querySelector('.calculator-result-label').textContent = 'Copied to clipboard!';

                            setTimeout(() => {
                                calculatorResult.querySelector('.calculator-result-label').textContent = originalLabel;
                            }, 1500);
                        })
                        .catch(err => {
                            console.error('Failed to copy: ', err);
                        });
                }
            });

            // Generate random signal
            function generateRandomSignal(isAI = false) {
                if (isCooldown) {
                    // Show cooldown message
                    if (isAI) {
                        aiGenerateCooldownMessage.classList.add('active');
                        setTimeout(() => {
                            aiGenerateCooldownMessage.classList.remove('active');
                        }, 1500);
                    } else {
                        generateCooldownMessage.classList.add('active');
                        setTimeout(() => {
                            generateCooldownMessage.classList.remove('active');
                        }, 1500);
                    }
                    return;
                }

                // Start cooldown
                isCooldown = true;

                // Set cooldown timeout
                setTimeout(() => {
                    isCooldown = false;
                }, cooldownDuration);

                const pairs = Array.from(currencyPairSelect.options).map(opt => opt.text);

                // If AI mode - select random pair only (timeframe remains the same)
                if (isAI) {
                    const randomPairIndex = Math.floor(Math.random() * pairs.length);
                    currencyPairSelect.selectedIndex = randomPairIndex;
                }

                const pair = currencyPairSelect.value;
                const timeframe = timeframeSelect.value;
                const isBuy = Math.random() > 0.5;
                const accuracy = (Math.random() * 10 + 85).toFixed(2);
                const volatility = (Math.random() * 30 + 20).toFixed(2);
                const strength = Math.max(3, Math.floor(Math.random() * 5) + 1); // Minimum 3 stars

                const now = new Date();
                const timeString = now.toLocaleTimeString();
                const dateString = now.toLocaleDateString();

                // Show loading
                signalResult.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">${isAI ? 'AI analyzing market...' : 'Analyzing data...'}</div>
                    </div>
                `;

                // Clear chart and indicators during loading
                chartContainer.innerHTML = '<div class="chart-placeholder"><i class="fas fa-chart-line"></i><p>Generating chart...</p></div>';
                indicatorsContainer.innerHTML = '<div class="indicators-placeholder"><i class="fas fa-chart-bar"></i><p>Calculating indicators...</p></div>';

                // Simulate analysis delay (1-3 seconds)
                const delay = 1000 + Math.random() * 2000;

                setTimeout(() => {
                    // Generate technical indicators (now tied to signal direction)
                    generateIndicators(pair, isBuy);

                    // Display signal
                    signalResult.innerHTML = `
                        <div class="signal-main">
                            <div class="signal-pair">${pair}</div>
                            <div class="signal-direction ${isBuy ? 'signal-buy' : 'signal-sell'}">
                                ${isBuy ? 'BUY' : 'SELL'}
                            </div>
                            <div class="signal-accuracy">Accuracy: ${accuracy}%</div>
                        </div>
                        <div class="signal-details">
                            <div class="signal-detail">
                                <div class="detail-label">Timeframe</div>
                                <div class="detail-value">${timeframe}</div>
                            </div>
                            <div class="signal-detail">
                                <div class="detail-label">Signal Strength</div>
                                <div class="detail-value">${'★'.repeat(strength)}${'☆'.repeat(5-strength)}</div>
                            </div>
                            <div class="signal-detail">
                                <div class="detail-label">Volatility</div>
                                <div class="detail-value">${volatility}%</div>
                            </div>
                            <div class="signal-detail">
                                <div class="detail-label">Signal Type</div>
                                <div class="detail-value">${isAI ? 'AI Generated' : 'Standard'}</div>
                            </div>
                        </div>
                    `;

                    signalTime.textContent = `${dateString} ${timeString}`;

                    // Draw chart
                    renderChart(pair, isBuy);
                }, delay);
            }

            // Generate technical indicators (now tied to signal direction)
            function generateIndicators(pair, isBuy) {
                // Base values that will be adjusted based on signal direction
                const indicators = [
                    {
                        name: "RSI (14)",
                        value: isBuy ? (Math.random() * 15 + 30).toFixed(2) : (Math.random() * 15 + 55).toFixed(2),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    },
                    {
                        name: "MACD",
                        value: isBuy ? (Math.random() > 0.2 ? "Buy" : "Neutral") : (Math.random() > 0.8 ? "Buy" : "Sell"),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    },
                    {
                        name: "Bollinger",
                        value: isBuy ? (Math.random() > 0.2 ? "Bottom" : "Middle") : (Math.random() > 0.8 ? "Bottom" : "Top"),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    },
                    {
                        name: "Stochastic",
                        value: isBuy ? (Math.random() * 20 + 20).toFixed(2) : (Math.random() * 20 + 60).toFixed(2),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    },
                    {
                        name: "Ichimoku",
                        value: isBuy ? (Math.random() > 0.2 ? "Bullish" : "Neutral") : (Math.random() > 0.8 ? "Bullish" : "Bearish"),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    },
                    {
                        name: "ADX",
                        value: (Math.random() * 20 + 15).toFixed(2),
                        status: (Math.random() > 0.5 ? "positive" : "negative")
                    },
                    {
                        name: "Volume",
                        value: isBuy ? (Math.random() > 0.2 ? "Growing" : "Stable") : (Math.random() > 0.8 ? "Growing" : "Falling"),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    },
                    {
                        name: "CCI",
                        value: isBuy ? (Math.random() * 50 - 100).toFixed(2) : (Math.random() * 50 + 100).toFixed(2),
                        status: isBuy ? (Math.random() > 0.2 ? "positive" : "negative") : (Math.random() > 0.8 ? "positive" : "negative")
                    }
                ];

                // Ensure at least 6 indicators match the signal direction
                const matchingIndicators = indicators.filter(ind =>
                    (isBuy && ind.status === "positive") || (!isBuy && ind.status === "negative")
                );

                if (matchingIndicators.length < 6) {
                    // Need to adjust some indicators to match the signal direction
                    const diff = 6 - matchingIndicators.length;
                    const nonMatching = indicators.filter(ind =>
                        (isBuy && ind.status !== "positive") || (!isBuy && ind.status !== "negative")
                    );

                    // Randomly select diff indicators to flip
                    for (let i = 0; i < diff && i < nonMatching.length; i++) {
                        nonMatching[i].status = isBuy ? "positive" : "negative";

                        // Adjust values to match the new status
                        if (nonMatching[i].name === "RSI (14)") {
                            nonMatching[i].value = isBuy ? (Math.random() * 15 + 30).toFixed(2) : (Math.random() * 15 + 55).toFixed(2);
                        } else if (nonMatching[i].name === "Stochastic") {
                            nonMatching[i].value = isBuy ? (Math.random() * 20 + 20).toFixed(2) : (Math.random() * 20 + 60).toFixed(2);
                        } else if (nonMatching[i].name === "CCI") {
                            nonMatching[i].value = isBuy ? (Math.random() * 50 - 100).toFixed(2) : (Math.random() * 50 + 100).toFixed(2);
                        }
                    }
                }

                let indicatorsHTML = "";

                indicators.forEach(ind => {
                    let progress;

                    if (ind.name === "RSI (14)") {
                        progress = parseFloat(ind.value);
                    } else if (ind.name === "ADX") {
                        progress = parseFloat(ind.value);
                    } else if (ind.name === "Stochastic") {
                        progress = parseFloat(ind.value);
                    } else if (ind.name === "CCI") {
                        progress = (parseFloat(ind.value) + 200) / 4; // Scale -200 to +200 to 0-100
                    } else {
                        progress = ind.status === "positive" ?
                            (isBuy ? Math.random() * 30 + 70 : Math.random() * 30 + 20) :
                            (isBuy ? Math.random() * 30 + 20 : Math.random() * 30 + 70);
                    }

                    indicatorsHTML += `
                        <div class="indicator">
                            <div class="indicator-header">
                                <div class="indicator-title">${ind.name}</div>
                                <div class="indicator-value ${ind.status}">${ind.value}</div>
                            </div>
                            <div class="indicator-bar">
                                <div class="indicator-progress" style="width: ${progress}%; background-color: ${ind.status === 'positive' ? 'var(--accent-green)' : 'var(--accent-red)'}"></div>
                            </div>
                        </div>
                    `;
                });

                indicatorsContainer.innerHTML = indicatorsHTML;
            }

            // Draw chart
            function renderChart(pair, isBuy) {
                // Clear previous chart
                chartContainer.innerHTML = "";

                const width = chartContainer.clientWidth;
                const height = chartContainer.clientHeight;
                const margin = { top: 20, right: 20, bottom: 30, left: 40 };

                const svg = d3.select(chartContainer)
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

                const chartGroup = svg.append("g")
                    .attr("transform", `translate(${margin.left}, ${margin.top})`);

                const chartWidth = width - margin.left - margin.right;
                const chartHeight = height - margin.top - margin.bottom;

                // Generate random data with trend based on signal direction
                const data = [];
                let currentValue = 100 + Math.random() * 10;
                const trend = isBuy ? 1 : -1;

                for (let i = 0; i < 30; i++) {
                    const open = currentValue;
                    const change = (Math.random() * 2 - 1) + trend * 0.5;
                    currentValue += change;
                    const close = currentValue;
                    const high = Math.max(open, close) + Math.random() * 1.5;
                    const low = Math.min(open, close) - Math.random() * 1.5;

                    data.push({
                        time: i,
                        open,
                        high,
                        low,
                        close
                    });
                }

                // Scales
                const x = d3.scaleBand()
                    .domain(data.map(d => d.time))
                    .range([0, chartWidth])
                    .padding(0.2);

                const y = d3.scaleLinear()
                    .domain([d3.min(data, d => d.low) * 0.995, d3.max(data, d => d.high) * 1.005])
                    .range([chartHeight, 0]);

                // Axes
                chartGroup.append("g")
                    .attr("transform", `translate(0, ${chartHeight})`)
                    .call(d3.axisBottom(x).tickValues([]));

                chartGroup.append("g")
                    .call(d3.axisLeft(y));

                // Candles
                data.forEach(d => {
                    const candleGroup = chartGroup.append("g")
                        .attr("transform", `translate(${x(d.time)}, 0)`);

                    // Candle line
                    candleGroup.append("line")
                        .attr("x1", x.bandwidth() / 2)
                        .attr("x2", x.bandwidth() / 2)
                        .attr("y1", y(d.high))
                        .attr("y2", y(d.low))
                        .attr("stroke", d.open > d.close ? "var(--accent-red)" : "var(--accent-green)")
                        .attr("stroke-width", 1);

                    // Candle body
                    candleGroup.append("rect")
                        .attr("x", 0)
                        .attr("y", y(Math.max(d.open, d.close)))
                        .attr("width", x.bandwidth())
                        .attr("height", Math.abs(y(d.open) - y(d.close)))
                        .attr("fill", d.open > d.close ? "var(--accent-red)" : "var(--accent-green)");
                });

                // Trend line
                const line = d3.line()
                    .x(d => x(d.time) + x.bandwidth() / 2)
                    .y(d => y(d.close));

                chartGroup.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", isBuy ? "var(--accent-green)" : "var(--accent-red)")
                    .attr("stroke-width", 2)
                    .attr("d", line);
            }

            // Event handlers
            generateBtn.addEventListener("click", () => {
                generateRandomSignal(false);
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove("active");
                }
            });

            aiGenerateBtn.addEventListener("click", () => {
                generateRandomSignal(true);
                if (window.innerWidth <= 992) {
                    sidebar.classList.remove("active");
                }
            });

            // Handle window resize
            function handleResize() {
                const menuToggle = document.getElementById('menu-toggle');
                const sidebar = document.getElementById('sidebar');
                
                if (window.innerWidth <= 992) {
                    menuToggle.style.display = 'flex';
                    if (!sidebar.classList.contains('active')) {
                        sidebar.classList.remove('active');
                    }
                } else {
                    menuToggle.style.display = 'none';
                    sidebar.classList.remove('active');
                }
            }

            window.addEventListener("resize", handleResize);
            handleResize();

            // Initialize Telegram WebApp
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
            }
        });
    </script>
</body>
</html>
